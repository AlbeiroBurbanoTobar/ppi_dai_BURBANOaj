{% extends 'base.html' %}

{% block content %}
<div class="calendar-container">
    <h1 id="tournamentTitle">PodiúmPro</h1>
    <div class="controls">
        <select id="tournamentSelect">
            <option value="" disabled selected>Selecciona un torneo</option>
        </select>
        
        <button id="prev" onclick="changeMonth(-1)">Anterior mes</button>
        <button id="next" onclick="changeMonth(1)">Siguiente mes</button>
    </div>
    <div id="monthYearDisplay"></div>
    <table class="calendar">
        <thead>
            <tr>
                <th>Domingo</th>
                <th>Lunes</th>
                <th>Martes</th>
                <th>Miércoles</th>
                <th>Jueves</th>
                <th>Viernes</th>
                <th>Sábado</th>
            </tr>
        </thead>
        <tbody id="calendarBody">
        </tbody>
    </table>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    fetchTournaments();
});

function fetchTournaments() {
    fetch('/get-tournaments')  // Asume que este es tu endpoint para obtener torneos
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('tournamentSelect');
            data.forEach(torneo => {
                const option = document.createElement('option');
                option.value = torneo.id;
                option.textContent = torneo.nombre;
                select.appendChild(option);
            });
        })
        .catch(error => console.error('Error al cargar torneos:', error));
}
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    loadTournaments();
    generateCalendar();

    const select = document.getElementById('tournamentSelect');
    const title = document.getElementById('tournamentTitle');

    // Carga inicial del título
    select.addEventListener('change', function() {
        // Cambia el título según el torneo seleccionado
        title.textContent = select.options[select.selectedIndex].text;
    });
});

function loadTournaments() {
    fetch('/get-user-tournaments')  // Asume que este es tu endpoint para obtener torneos
        .then(response => response.json())
        .then(tournaments => {
            const select = document.getElementById('tournamentSelect');
            select.innerHTML = ''; // Limpiar opciones existentes

            // Añadir opción predeterminada
            const defaultOption = document.createElement('option');
            defaultOption.textContent = 'Selecciona un torneo';
            defaultOption.value = '';
            defaultOption.disabled = true;
            defaultOption.selected = true;
            select.appendChild(defaultOption);

            // Añadir opciones de torneos
            tournaments.forEach(tournament => {
                const option = document.createElement('option');
                option.value = tournament.id;
                option.textContent = tournament.name;
                select.appendChild(option);
            });

            // Asegúrate de disparar el evento change una vez que los torneos se cargan
            select.dispatchEvent(new Event('change'));
        });
}

</script>

<script>

const now = new Date();
let currentMonth = now.getMonth();
let currentYear = now.getFullYear();

document.addEventListener('DOMContentLoaded', function() {
    loadTournaments();
    generateCalendar(currentMonth, currentYear);
});



function generateCalendar(month, year) {
    const firstDay = new Date(year, month).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    const tbody = document.getElementById('calendarBody');
    const monthYearDisplay = document.getElementById('monthYearDisplay');

    // Actualiza el título para mostrar el mes y el año correctos
    monthYearDisplay.textContent = `${monthNames[month]} ${year}`;

    tbody.innerHTML = ''; // Limpiar el cuerpo del calendario

    let date = 1;
    for (let i = 0; i < 6; i++) { // hasta 6 semanas para cubrir todos los días
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
            const cell = document.createElement('td');
            if (i === 0 && j < firstDay) {
                cell.textContent = '';
            } else if (date > daysInMonth) {
                cell.textContent = ''; // Continuar añadiendo celdas vacías si el mes terminó
            } else {
                cell.textContent = date;
                date++;
            }
            row.appendChild(cell);
        }
        tbody.appendChild(row);
    }
}


const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

function changeMonth(step) {
    currentMonth += step;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    generateCalendar(currentMonth, currentYear);
}


</script>
{% endblock %}
 