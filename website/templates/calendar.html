{% extends 'base.html' %}

{% block content %}
<div class="calendar-container">
    <h1 id="tournamentTitle" style="text-align: center;">PodiúmPro</h1>
    <div class="schedule-form">
        <h2>Programar Partido</h2>
        <form method="POST" action="{{ url_for('views.schedule_match') }}">
        <div class="controlsSuperior">
            <a>Selecciona el torneo: </a>
            <select id="tournamentSelect" name="tournamentSelect" required>
                <option value="" disabled selected>Selecciona un torneo</option>
            </select>
        </div>

        <div class="form-group">
            <label for="categoria">Categoría</label>
            <select class="form-control" id="categoria" name="categoria" onchange="updateTeamLists()" required>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
            </select>
        </div>
        
        
        
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="date">Fecha</label>
                    <input type="date" id="date" name="date" class="form-control" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="teamA">Equipo A</label>
                    <select id="teamA" name="teamA" class="form-control" required>
                        <option value="">Selecciona un equipo</option>
                        <!-- Las opciones se añadirán dinámicamente -->
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="teamB">Equipo B</label>
                    <select id="teamB" name="teamB" class="form-control" required>
                        <option value="">Selecciona un equipo</option>
                        <!-- Las opciones se añadirán dinámicamente -->
                    </select>
                </div>

                <div class="form-group col-md-6">
                    <label for="referee">Árbitro</label>
                    <input type="text" id="referee" name="referee" class="form-control" required>
    
            </div>
            </div>
            <div class="form-group">
                <label for="location">Lugar</label>
                <input type="text" id="location" name="location" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary">Programar partido</button>
        </form>
    </div>
    <br>
    <div class="controlsSuperior">      
        <button id="prev" onclick="changeMonth(-1)">Anterior mes</button>
        <button id="next" onclick="changeMonth(1)">Siguiente mes</button>
    </div>
    <div id="monthYearDisplay"></div>
    <table class="calendar">
        <thead>
            <tr>
                <th>Domingo</th>
                <th>Lunes</th>
                <th>Martes</th>
                <th>Miércoles</th>
                <th>Jueves</th>
                <th>Viernes</th>
                <th>Sábado</th>
            </tr>
        </thead>
        <tbody id="calendarBody">
        </tbody>
    </table>

    
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    fetchTournaments();
});

function fetchTournaments() {
    fetch('/get-tournaments')  // Asume que este es tu endpoint para obtener torneos
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('tournamentSelect');
            data.forEach(torneo => {
                const option = document.createElement('option');
                option.value = torneo.nombre;  // Cambia aquí para usar el nombre como valor
                option.textContent = torneo.nombre;
                select.appendChild(option);
            });
        })
        .catch(error => console.error('Error al cargar torneos:', error));
}

</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    loadTournaments();
    generateCalendar();

    const select = document.getElementById('tournamentSelect');
    const title = document.getElementById('tournamentTitle');

    // Carga inicial del título
    select.addEventListener('change', function() {
        // Cambia el título según el torneo seleccionado
        title.textContent = select.options[select.selectedIndex].text;
    });
});

function loadTournaments() {
    fetch('/get-user-tournaments')  // Asume que este es tu endpoint para obtener torneos
        .then(response => response.json())
        .then(tournaments => {
            const select = document.getElementById('tournamentSelect');
            select.innerHTML = ''; // Limpiar opciones existentes

            // Añadir opción predeterminada
            const defaultOption = document.createElement('option');
            defaultOption.textContent = 'Selecciona un torneo';
            defaultOption.value = '';
            defaultOption.disabled = true;
            defaultOption.selected = true;
            select.appendChild(defaultOption);

            // Añadir opciones de torneos
            tournaments.forEach(tournament => {
                const option = document.createElement('option');
                option.value = tournament.id;
                option.textContent = tournament.name;
                select.appendChild(option);
            });

            // Asegúrate de disparar el evento change una vez que los torneos se cargan
            select.dispatchEvent(new Event('change'));
        });
}

</script>

<script>

const now = new Date();
let currentMonth = now.getMonth();
let currentYear = now.getFullYear();

document.addEventListener('DOMContentLoaded', function() {
    loadTournaments();
    generateCalendar(currentMonth, currentYear);
});



function generateCalendar(month, year) {
    const now = new Date();
    const todayDate = now.getDate();
    const todayMonth = now.getMonth();
    const todayYear = now.getFullYear();

    const firstDay = new Date(year, month).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    const tbody = document.getElementById('calendarBody');
    const monthYearDisplay = document.getElementById('monthYearDisplay');

    // Actualiza el título para mostrar el mes y el año correctos
    monthYearDisplay.textContent = `${monthNames[month]} ${year}`;

    tbody.innerHTML = ''; // Limpiar el cuerpo del calendario

    let date = 1;
    for (let i = 0; i < 6; i++) { // hasta 6 semanas para cubrir todos los días
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
            const cell = document.createElement('td');
            if (i === 0 && j < firstDay) {
                cell.textContent = '';
            } else if (date > daysInMonth) {
                cell.textContent = ''; // Continuar añadiendo celdas vacías si el mes terminó
            } else {
                if (date === todayDate && month === todayMonth && year === todayYear) {
                    cell.classList.add('today');
                }
                cell.textContent = date;
                date++;
            }
            row.appendChild(cell);
        }
        tbody.appendChild(row);
    }
}



const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

function changeMonth(step) {
    currentMonth += step;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    generateCalendar(currentMonth, currentYear);
}


</script>

<script>

document.addEventListener('DOMContentLoaded', function() {
    loadTeams();
});

function loadTeams() {
    fetch('/get-user-teams')  // Asume que tienes un endpoint que devuelve los equipos del usuario
        .then(response => response.json())
        .then(teams => {
            const teamASelect = document.getElementById('teamA');
            const teamBSelect = document.getElementById('teamB');
            teams.forEach(team => {
                const optionA = document.createElement('option');
                optionA.value = team.id;
                optionA.textContent = team.name;
                teamASelect.appendChild(optionA);

                const optionB = document.createElement('option');
                optionB.value = team.id;
                optionB.textContent = team.name;
                teamBSelect.appendChild(optionB);
            });
        })
        .catch(error => console.error('Error al cargar los equipos:', error));
}

</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const teamASelect = document.getElementById('teamA');
    const teamBSelect = document.getElementById('teamB');

    teamASelect.addEventListener('change', function() {
        adjustTeamOptions(teamBSelect, teamASelect);
    });

    teamBSelect.addEventListener('change', function() {
        adjustTeamOptions(teamASelect, teamBSelect);
    });
});

function adjustTeamOptions(targetSelect, referenceSelect) {
    const selectedValue = referenceSelect.value;
    const options = targetSelect.querySelectorAll('option');

    options.forEach(option => {
        if (option.value === selectedValue) {
            option.disabled = true; // Deshabilita la opción que ya está seleccionada en el otro select
        } else {
            option.disabled = false; // Habilita todas las otras opciones
        }
    });
}

</script>

<script>
    function updateTeamLists() {
        const categoria = document.getElementById('categoria').value;

    const url = `/get-teams/${categoria}`;
    fetch(url)
        .then(response => response.json())
        .then(data => {
            const teamASelect = document.getElementById('teamA');
            const teamBSelect = document.getElementById('teamB');
            teamASelect.innerHTML = '';
            teamBSelect.innerHTML = '';
            
            data.forEach(team => {
                const optionA = document.createElement('option');
                optionA.value = team.id;
                optionA.textContent = team.name;
                teamASelect.appendChild(optionA);
                
                const optionB = document.createElement('option');
                optionB.value = team.id;
                optionB.textContent = team.name;
                teamBSelect.appendChild(optionB);
            });
        })
        .catch(error => console.error('Error al cargar los equipos:', error));
}

</script>
{% endblock %}
 

