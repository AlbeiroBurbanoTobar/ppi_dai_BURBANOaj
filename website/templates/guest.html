{% extends "base.html" %}

{% block title %}
Guest
{% endblock %}

{% block content %}
<!-- Título de la página con la etiqueta H1 para la sección de torneos. -->
<h1 align="center">Torneos</h1>

<!-- Carrusel de torneos con bordes redondeados. -->
<div id="tournamentCarousel" class="carousel slide" data-ride="carousel" style="max-width: 1000px; margin: auto; overflow: hidden; border-radius: 15px;">
  <div class="carousel-inner">
    {% for torneo in torneos %}
      {% if torneo.deporte | lower == 'baloncesto' %}
        {% set image_url = 'https://raw.githubusercontent.com/AlbeiroBurbano/ImagenesIconos/main/baloncesto.jpg' %}
      {% else %}
        {% set image_url = 'https://raw.githubusercontent.com/AlbeiroBurbano/ImagenesIconos/main/futbol.jpg' %}
      {% endif %}
      
      <!-- Item del carrusel con la información del torneo y su imagen. -->
      <div class="carousel-item {{ 'active' if loop.first }}" style="border-radius: 15px; overflow: hidden;">
        <div style="background-image: url('{{ image_url }}'); background-size: cover; background-position: center; height: 280px; border-radius: 15px;">
          <div style="height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <h5 style="color: white; text-shadow: 2px 2px 4px #000000;">{{ torneo.nombre }}</h5>
            <p style="color: white; text-shadow: 2px 2px 4px #000000;">Fecha: {{ torneo.fecha_inicio }} - {{ torneo.fecha_final }}</p>
            <p style="color: white; text-shadow: 2px 2px 4px #000000;">Deporte: {{ torneo.deporte }}</p>
            <p style="color: white; text-shadow: 2px 2px 4px #000000;">Equipos: {{ torneo.equipos_participantes }}</p>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Controles de navegación del carrusel. -->
  <a class="carousel-control-prev" href="#tournamentCarousel" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#tournamentCarousel" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Siguiente</span>
  </a>
</div>

<br>
<!-- Sección para seleccionar torneos y ver más información -->
<div class="container" align="center">
  <label for="tournamentSelect">Selecciona un torneo:</label>
  <select id="tournamentSelect" class="form-control" style="max-width: 300px; display: inline-block;">
      {% for torneo in torneos %}
          <option value="{{ torneo.nombre }}">{{ torneo.nombre }}</option>
      {% endfor %}
  </select>
  <button id="moreInfoBtn" class="btn btn-primary" style="margin-left: 10px;">Más Información</button>
</div>

<!-- Modal para mostrar la información del torneo -->
<div class="modal fade" id="tournamentInfoModal" tabindex="-1" role="dialog" aria-labelledby="tournamentInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl custom-modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tournamentInfoModalLabel">Información del Torneo</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Descripción de la tabla -->
        <p>Esta tabla muestra los detalles de los partidos programados para el torneo seleccionado, incluyendo las puntuaciones y las faltas de cada equipo.</p>
        <!-- Aquí se llenará la información del torneo -->
        <div id="tournamentInfoContent"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para mostrar el mapa -->
<div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="mapModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="mapModalLabel">Mapa de la ubicación del partido</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img id="mapImage" src="" alt="Mapa de la ubicación del partido" class="img-fluid">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<!-- Sección para el calendario de todos los partidos -->
<div class="container">
  <h2 class="my-4">Calendario de Todos los Partidos</h2>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Torneo</th>
        <th>Equipo A</th>
        <th>Equipo B</th>
        <th>Ubicación</th>
        <th>Hora</th>
        <th>Categoría</th>
        <th>Mapa</th> <!-- Nueva columna para el botón del mapa -->
      </tr>
    </thead>
    <tbody>
      {% for match in matches %}
      <tr>
        <td>{{ match.match_date }}</td>
        <td>{{ match.tournament_name }}</td>
        <td>{{ match.team_a }}</td>
        <td>{{ match.team_b }}</td>
        <td>{{ match.location }}</td>
        <td>{{ match.match_time }}</td>
        <td>{{ match.categoria }}</td>
        <td><button class="btn btn-info" data-toggle="modal" data-target="#mapModal" onclick="loadMap('{{ match.location }}')">Ver Mapa</button></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Gráfica de distribución de partidos por fecha (gráfica de línea)-->
<div style="text-align: center;">
  <h2 class="my-4">Distribución de Partidos por Fecha</h2>
  <p>En esta gráfica puedes ver cómo se distribuyen todos los partidos a lo largo del tiempo.
    Cada punto en la línea indica la cantidad de partidos programados para una fecha específica.
    Esta visualización puede ayudar a entender cuándo hay más actividad y cómo se concentran los partidos en el calendario.</p>

  <img src="data:image/png;base64,{{ image_base64 }}" alt="Distribución de Partidos por Fecha">
</div>

<!-- Nueva gráfica de distribución de equipos por categoría (gráfica de barras) -->
<div style="text-align: center;">
  <h2 class="my-4">Distribución de Equipos por Categoría</h2>
  <p>Esta gráfica muestra la cantidad de equipos en cada categoría.
    Los equipos masculinos están representados en azul y los equipos femeninos en rosa.
    Esto te permite ver rápidamente cómo se distribuyen los equipos según su género.</p>

  <img src="data:image/png;base64,{{ category_image_base64 }}" alt="Distribución de Equipos por Categoría">
</div>

<br>
<br>
<br>
<br>

<!-- Sección de la firma del desarrollador. -->
<div id="mi-firma">
  <span>Created by Albeiro Burbano :)  </span>
  <a href="mailto:aburbanot@unal.edu.co">
    <img src="../static/email-icon.png" alt="Enviar correo" style="width: 24px; height: 24px; vertical-align: middle;">
  </a>
  <a href="https://www.freelancer.com/u/Albeiro73?sb=t">
    <img src="../static/free-icon .png" alt="Ver perfil en freelancer" style="width: 24px; height: 24px; vertical-align: middle;">
  </a>
  <a href="https://github.com/AlbeiroBurbanoTobar/ppi_pl_BurbanoA">
    <img src="../static/git-icon.png" alt="Ver repositorio" style="width: 24px; height: 24px; vertical-align: middle;">
  </a>
  <a href="https://stackoverflow.com/users/24090991/albeiro-burbano">
    <img src="../static/stack-icon.png" alt="Mira el perfil de stackoverflow" style="width: 24px; height: 24px; vertical-align: middle;">
  </a>
  <a href="http://www.linkedin.com/in/albeiro-jose-burbano-tobar-759ba4297">
    <img src="../static/link-icon.png" alt="Mira el perfil de linkedin" style="width: 24px; height: 24px; vertical-align: middle;">
  </a>
</div>

<!-- Añadir estilos CSS personalizados -->
<style>
  .custom-modal-dialog {
      max-width: 100%;
      width: 100%;
  }
  .custom-modal-content {
      height: 90vh;
  }
</style>

<script>
document.getElementById('moreInfoBtn').addEventListener('click', function() {
    var select = document.getElementById('tournamentSelect');
    var selectedTournament = select.options[select.selectedIndex].value;
    
    fetch(`/get-tournament-info/${selectedTournament}`)
        .then(response => response.json())
        .then(data => {
            var content = "<table class='table table-bordered'><thead><tr><th>Fecha</th><th>Equipo A</th><th>Equipo B</th><th>Ubicación</th><th>Hora</th><th>Categoría</th><th>Score Equipo A</th><th>Score Equipo B</th><th>Faltas Equipo A</th><th>Faltas Equipo B</th><th>Media Puntuaciones</th><th>Media Faltas</th></tr></thead><tbody>";
            data.matches.forEach(match => {
                content += `<tr>
                    <td>${match.match_date}</td>
                    <td>${match.team_a}</td>
                    <td>${match.team_b}</td>
                    <td>${match.location}</td>
                    <td>${match.match_time}</td>
                    <td>${match.categoria}</td>
                    <td>${match.team_a_score}</td>
                    <td>${match.team_b_score}</td>
                    <td>${match.faltas_team_a}</td>
                    <td>${match.faltas_team_b}</td>
                    <td>${match.media_puntuacion.toFixed(2)}</td>
                    <td>${match.media_faltas.toFixed(2)}</td>
                </tr>`;
            });
            content += "</tbody></table>";
            document.getElementById('tournamentInfoContent').innerHTML = content;
            $('#tournamentInfoModal').modal('show');
        })
        .catch(error => console.error('Error:', error));
});

function loadMap(address) {
  fetch(`/get-map/${address}`)
    .then(response => response.json())
    .then(data => {
      if (data.image_base64) {
        document.getElementById('mapImage').src = `data:image/png;base64,${data.image_base64}`;
      } else {
        alert('No se pudieron obtener las coordenadas para la ubicación proporcionada.');
      }
    })
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock %}
